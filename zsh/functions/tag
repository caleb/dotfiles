#
# Generates tags for a project
#

if (( $+commands[ripper-tags] )); then
  echo "Generating ripper-tags"
  ripper-tags -R .
else
  echo "ripper-tags not installed"
fi

# Make sure ctags is installed and it's exuberant ctags (bsd ctags fails on ctags --version)
if (( $+commands[ctags] )) && $(ctags --version > /dev/null 2>&1); then
  echo "Generating Exuberant Tags"
  ctags -a -R .

  # ctags doesn't handle negative look behinds so instead we use this code to
  # strip false positives out of the tags file
  FILE="tags"

  # Filter out false matches from class method regex
  sed -i '' -E '/^(if|switch|function|module\.exports|it|describe)    .+language:js$/d' $FILE

  # Filter out false matches from object definition regex
  sed -i '' -E '/var[     ]+[a-zA-Z0-9_$]+[   ]+=[    ]+require\(.+language:js$/d' $FILE
else
  echo "exuberant ctags is not installed (install from homebrew)"
fi
